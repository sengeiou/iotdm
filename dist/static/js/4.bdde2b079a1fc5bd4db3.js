webpackJsonp([4],{"/z/K":function(e,t){},C3bj:function(e,t){},GcK5:function(e,t){},JXHZ:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("aA9S"),s=a.n(i),n={name:"overView",props:["deviceId"],data:function(){return{isEdit:!1,deviceObj:{},nodeArr:[{value:"GATEWAY",label:"直连设备"},{value:"ENDPOINT",label:"网关子设备"}],stateArr:[{value:"ONLINE",color:"#15C937",label:"在线"},{value:"WARN",color:"#C91521",label:"告警"},{value:"INACTIVE",color:"#beccfa",label:"未激活"},{value:"OFFLINE",color:"#C8421B",label:"离线"},{value:"STOP",color:"#C8A01B",label:"STOP"}],deviceData:[],timer:""}},activated:function(){this.getDetails(),this.getDeviceDatas(),this.setDeviceData()},created:function(){this.getDetails(),this.getDeviceDatas(),this.setDeviceData()},beforeDestroy:function(){clearInterval(this.timer),this.timer=null},methods:{getDetails:function(){var e=this;this.$api.getDeviceDetails(this.deviceId).then(function(t){e.deviceObj=t.data,s()(e.deviceObj,{createTime:e.$getDate({timestamp:e.deviceObj.createTime})})})},deviceBtn:function(){this.isEdit=!0},deviceClose:function(){this.isEdit=!1,this.getDetails()},deviceEdit:function(){var e=this,t={deviceId:this.deviceObj.id,deviceLabel:this.deviceObj.deviceLabel};this.$api.putDevice(t).then(function(t){e.isEdit=!1,e.getDetails()})},lookView:function(){this.$emit("tabIndex","3")},copyText:function(e){var t=document.createElement("input");t.setAttribute("id","copyTextInput"),t.value=e,document.getElementsByTagName("body")[0].appendChild(t),document.getElementById("copyTextInput").select(),document.execCommand("copy"),document.getElementById("copyTextInput").remove(),this.$message.success("复制成功")},getDeviceDatas:function(){var e=this,t={deviceId:this.deviceId};this.$api.getDeviceData(t).then(function(t){e.deviceData=t.data,e.deviceData.map(function(t){s()(t,{modelLabel:"<"+t.modelLabel+">",ts:e.$getDate({timestamp:t.ts})})})})},setDeviceData:function(){var e=this;this.timer=setInterval(function(){e.getDeviceDatas()},6e3)},goProduct:function(e){this.$router.push({path:"/productDetails",query:{id:e}})}}},l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"dev-content"},[a("div",{staticClass:"table-detail"},[a("div",{staticClass:"detail-title"},[a("div",{staticClass:"titles"},[e.isEdit?a("div",{staticClass:"titles-ipt"},[a("a-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.deviceObj.deviceLabel,callback:function(t){e.$set(e.deviceObj,"deviceLabel",t)},expression:"deviceObj.deviceLabel"}}),e._v(" "),a("a-icon",{staticStyle:{color:"#15C937"},attrs:{type:"check"},on:{click:e.deviceEdit}}),e._v(" "),a("a-icon",{staticStyle:{color:"#C91521","margin-left":"15px"},attrs:{type:"close"},on:{click:e.deviceClose}})],1):a("div",[a("span",[e._v(e._s(e.deviceObj.deviceLabel))]),e._v(" "),a("a-icon",{staticStyle:{color:"#45D7B6",width:"12px",height:"14px"},attrs:{type:"edit"},on:{click:e.deviceBtn}})],1)]),e._v(" "),a("div",{staticClass:"title-style"},e._l(e.stateArr,function(t,i){return t.value===e.deviceObj.deviceStatus?a("span",{key:i},[a("span",{staticClass:"device-status",style:{background:t.color}}),e._v("\n              "+e._s(t.label)+"\n            ")]):e._e()}),0),e._v(" "),a("div",{staticClass:"dev-product"},[e._v("\n            所属产品："),a("span",{on:{click:function(t){return e.goProduct(e.deviceObj.productId)}}},[e._v(" "+e._s(e.deviceObj.productLabel))])])]),e._v(" "),a("a-descriptions",{attrs:{column:2}},[a("a-descriptions-item",{attrs:{label:"设备标识码"}},[e._v("\n          "+e._s(e.deviceObj.deviceCode)+"\n          "),a("a-icon",{attrs:{type:"copy"},on:{click:function(t){return e.copyText(e.deviceObj.deviceCode)}}})],1),e._v(" "),a("a-descriptions-item",{attrs:{label:"设备ID"}},[e._v("\n          "+e._s(e.deviceObj.id)+"\n          "),a("a-icon",{attrs:{type:"copy"},on:{click:function(t){return e.copyText(e.deviceObj.id)}}})],1),e._v(" "),a("a-descriptions-item",{attrs:{label:"认证类型"}},["SECRET"===e.deviceObj.authType?a("span",[e._v("密钥")]):e._e()]),e._v(" "),a("a-descriptions-item",{attrs:{label:"设备密钥"}},[e._v("\n          "+e._s(e.deviceObj.deviceSecret)+"\n          "),a("a-icon",{attrs:{type:"copy"},on:{click:function(t){return e.copyText(e.deviceObj.deviceSecret)}}})],1),e._v(" "),a("a-descriptions-item",{attrs:{label:"注册时间"}},[e._v("\n          "+e._s(e.deviceObj.createTime)+"\n        ")]),e._v(" "),a("a-descriptions-item",{attrs:{label:"节点类型"}},e._l(e.nodeArr,function(t,i){return t.value===e.deviceObj.nodeType?a("span",{key:i},[e._v("\n            "+e._s(t.label)+"\n          ")]):e._e()}),0)],1)],1),e._v(" "),a("div",{staticClass:"dev-datas"},[a("div",{staticClass:"data-title"},[a("span",{staticClass:"titles"},[e._v("最新上报数据")]),e._v(" "),a("div",[a("a-button",{attrs:{type:"primary"},on:{click:e.lookView}},[e._v("查看全部属性")])],1)]),e._v(" "),a("div",{staticClass:"card-list"},e._l(e.deviceData,function(t,i){return a("div",{key:i,staticClass:"data-card"},[a("p",[e._v(e._s(t.propertyLabel))]),e._v(" "),a("p",[e._v(e._s(t.propertyValue)+" ")]),e._v(" "),a("span",{staticClass:"sub-title"},[e._v(" "+e._s(t.modelLabel)+" ")]),e._v(" "),a("span",[e._v(e._s(t.ts))])])}),0)])])])},staticRenderFns:[]};var o=a("C7Lr")(n,l,!1,function(e){a("/z/K")},"data-v-58a24e8d",null).exports,c=[{dataIndex:"sendStatus",ellipsis:!0,title:"状态",key:"sendStatus",scopedSlots:{customRender:"sendStatus"}},{dataIndex:"commandLabel",title:"命令名称",ellipsis:!0,key:"commandLabel"},{title:"命令ID",ellipsis:!0,dataIndex:"commandId",key:"commandId"},{title:"命令创建时间",ellipsis:!0,dataIndex:"createTime",key:"createTime"},{title:"平台发送时间",ellipsis:!0,dataIndex:"ts",key:"ts"},{title:"送达时间",ellipsis:!0,key:"respTs",dataIndex:"respTs"}],r={name:"equipmentList",props:["deviceId","productId"],data:function(){return{data:[],columns:c,searchObj:{commandLabel:""},sendStatusRrr:[{value:"FAIL",label:"失败"},{value:"SEND",label:"已发送"},{value:"SEND_ARRIVE",label:"发送到达"},{value:"SUCCESS",label:"成功"}],pagination:{showLessItems:!0,pageSizeOptions:["10","20","30"],showSizeChanger:!0,pageSize:10,current:1,hideOnSinglePage:!1,total:0},commandList:[],visible:!1,labelCol:{span:4},wrapperCol:{span:20},form:{deviceId:"",commandId:void 0,params:{}},isParams:!1,paramsArr:[],commandDataArr:[],rules:{commandId:[{required:!0,message:"请选择命令",trigger:["blur","change"]}]}}},created:function(){this.getList()},methods:{tableChange:function(e){this.pagination.pageSize=e.pageSize,this.pagination.current=e.current,this.pagination.total=e.total,this.getList()},getList:function(){var e=this,t={commandId:"",commandLabel:this.searchObj.commandLabel,deviceId:this.deviceId,page:this.pagination.current,pageSize:this.pagination.pageSize};this.$api.getDeviceCommandPage(t).then(function(t){var a=t.data;e.pagination.total=a.total,e.pagination.pageSize=a.size,e.pagination.current=a.current;var i=a.records;i.map(function(t){s()(t,{createTime:e.$getDate({timestamp:t.createTime}),ts:e.$getDate({timestamp:t.ts}),respTs:e.$getDate({timestamp:t.respTs})})}),e.data=i})},getProductCommand:function(){var e=this;this.$api.getProductInfo(this.productId).then(function(t){var a=t.data.models;e.commandDataArr=a,a.length>0&&a.map(function(t){t.commands.map(function(a){var i={};s()(i,{value:a.id,label:t.modelLabel+" : "+a.commandLabel,commandLabel:a.commandLabel,modelId:t.id}),e.commandList.push(i)})})})},handleChange:function(e){var t=this;this.paramsArr=[];var a=[];this.commandDataArr.map(function(e){t.commandList.map(function(i){e.id===i.modelId&&e.commands.map(function(e){t.form.commandId===e.id&&(a=e.params,t.isParams=!0)})})}),a.map(function(e){var a={};s()(a,{key:e.paramLabel,value:""}),t.paramsArr.push(a)})},showModal:function(){this.visible=!0,this.form={},this.commandList=[],this.paramsArr=[],this.getProductCommand()},handleOk:function(){var e=this;this.form.deviceId=this.deviceId;var t={};this.paramsArr.map(function(e){t[e.key]=e.value}),this.form.params=t,this.$refs.ruleForm.validate(function(t){t&&e.$api.sendDeviceCommand(e.form).then(function(t){e.visible=!1,e.getList()})})},closeHandle:function(){this.visible=!1,this.$refs.ruleForm.resetFields()},onSearch:function(){this.getList()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"command-content"},[a("div",{staticClass:"command-title"},[a("a-button",{attrs:{type:"primary"},on:{click:e.showModal}},[e._v("命令下发")]),e._v(" "),a("a-input-search",{staticStyle:{width:"200px",margin:"0 20px"},attrs:{allowClear:"",placeholder:"请输入命令名称搜索"},on:{blur:e.onSearch,search:e.onSearch},model:{value:e.searchObj.commandLabel,callback:function(t){e.$set(e.searchObj,"commandLabel",t)},expression:"searchObj.commandLabel"}})],1),e._v(" "),a("div",{staticClass:"table-box"},[a("a-table",{attrs:{columns:e.columns,rowKey:function(e,t){return t},pagination:e.pagination,"data-source":e.data},on:{change:e.tableChange},scopedSlots:e._u([{key:"name",fn:function(t){return a("span",{},[e._v(e._s(t))])}},{key:"sendStatus",fn:function(t){return a("span",{},e._l(e.sendStatusRrr,function(i,s){return i.value===t?a("span",{key:s},[e._v(e._s(i.label))]):e._e()}),0)}}])})],1)]),e._v(" "),a("a-modal",{attrs:{width:700,title:"下发命令"},on:{ok:e.handleOk,cancel:e.closeHandle},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{attrs:{label:"选择命令",prop:"commandId"}},[a("a-select",{attrs:{placeholder:"请选择命令"},on:{change:function(t){return e.handleChange()}},model:{value:e.form.commandId,callback:function(t){e.$set(e.form,"commandId",t)},expression:"form.commandId"}},e._l(e.commandList,function(t,i){return a("a-select-option",{key:i,attrs:{value:t.value}},[e._v("\n            "+e._s(t.label)+"\n          ")])}),1)],1),e._v(" "),e._l(e.paramsArr,function(t,i){return e.isParams?a("a-form-model-item",{key:i,attrs:{label:t.key}},[a("a-input",{attrs:{placeholder:"请输入参数"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"item.value"}})],1):e._e()})],2)],1)],1)},staticRenderFns:[]};var u={name:"commandAsy",props:["deviceId","productId"],components:{commandTable:a("C7Lr")(r,d,!1,function(e){a("r84h")},"data-v-bc21e27a",null).exports},methods:{callback:function(){}}},v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"command-content"},[t("div",{staticClass:"command-ays"},[this._m(0),this._v(" "),t("div",{staticClass:"ays-content"},[t("commandTable",{attrs:{deviceId:this.deviceId,productId:this.productId}})],1)])])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"ays-title"},[t("span",[this._v("历史命令下发")])])}]};var p=a("C7Lr")(u,v,!1,function(e){a("GcK5")},"data-v-77be4b2f",null).exports,m=a("4YfN"),h=a.n(m);var b=[{dataIndex:"modelLabel",title:"模型",ellipsis:!0,key:"modelLabel",scopedSlots:{customRender:"modelLabel"}},{dataIndex:"propertyLabel",title:"属性名称",ellipsis:!0,key:"propertyLabel"},{title:"访问方式",ellipsis:!0,dataIndex:"scope",key:"scope",scopedSlots:{customRender:"scope"}},{title:"上报值",ellipsis:!0,dataIndex:"propertyValue",key:"propertyValue"}],f={name:"equipmentShadow",props:["deviceId"],data:function(){return{data:[],columns:b,searchObj:{},customRenderList:["modelLabel"],pagination:{showLessItems:!0,pageSizeOptions:["10","20","30"],showSizeChanger:!0,pageSize:10,current:1,hideOnSinglePage:!1,total:0},visible:!1}},created:function(){this.getList()},computed:{columnsList:function(){var e=this,t=this.customRenderList;return this.columns.map(function(a){return t.includes(a.dataIndex)?h()({},a,{customRender:e.renderContent(a.dataIndex)}):h()({},a)})},customGoal:function(){var e={};return this.customRenderList.forEach(function(t){e[t]={value:null,index:null,rowSpanNumber:null}}),e}},methods:{renderContent:function(e){var t=this,a=e,i=this;return function(e,s,n){var l={children:e,attrs:{}},o=t.customGoal[a];if(e!==o.value){var c=function(e,t,a){var i=e,s=e,n=0;do{n+=1,s+=1}while(a[s]&&a[s][t]===a[i][t]);return n}(n,a,i.data);o.value=e,o.index=n,o.rowSpanNumber=c,l.attrs.rowSpan=c}else l.attrs.rowSpan=0;return l}},getList:function(){var e=this,t={deviceId:this.deviceId};this.$api.getDeviceShadowList(t).then(function(t){e.data=t.data})},showModal:function(){this.visible=!0},handleOk:function(e){this.visible=!1},onSearch:function(){}}},_={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"command-content"},[e._m(0),e._v(" "),a("div",{staticClass:"command-title"},[a("a-input-search",{staticStyle:{width:"200px"},attrs:{allowClear:"",placeholder:"请输入设备名称搜索"},on:{blur:e.onSearch,search:e.onSearch},model:{value:e.searchObj.name,callback:function(t){e.$set(e.searchObj,"name",t)},expression:"searchObj.name"}})],1),e._v(" "),a("div",{staticClass:"table-box"},[a("a-table",{attrs:{columns:e.columnsList,rowKey:function(e,t){return t},pagination:!1,"data-source":e.data},scopedSlots:e._u([{key:"modelLabel",fn:function(t){return a("span",{},[e._v(e._s(t))])}},{key:"scope",fn:function(t){return a("span",{},["R"===t?a("span",[e._v("可读")]):e._e(),e._v(" "),"W"===t?a("span",[e._v("可写")]):e._e(),e._v(" "),"RW"===t?a("span",[e._v("可读可写")]):e._e()])}}])})],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"shadow-title"},[t("p",[this._v("设备接入服务为每个设备添加“设备影子”，用于访问和控制设备的属性值。它通过可靠的数据存储能力，无论设备在线或者离线，您都能查询和更改设备的属性。")]),this._v(" "),t("p",[this._v(" 当设备离线时，“设备影子”将显示设备最近一次上报的属性值；通过下发“期望值”，“设备影子”将存储对设备属性的预期控制，当设备重新连接时，服务将“期望值”更新至设备。")])])}]};var g=[{dataIndex:"businessType",ellipsis:!0,title:"业务类型",key:"businessType",scopedSlots:{customRender:"businessType"}},{dataIndex:"businessStep",ellipsis:!0,title:"业务步骤",key:"businessStep",scopedSlots:{customRender:"businessStep"}},{title:"业务详情",ellipsis:!0,dataIndex:"businessDetails",key:"businessDetails"},{title:"记录时间",ellipsis:!0,dataIndex:"createTime",key:"createTime"},{title:"消息状态",ellipsis:!0,dataIndex:"messageStatus",key:"messageStatus",scopedSlots:{customRender:"messageStatus"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],y={name:"messageTrack",props:["deviceId"],data:function(){return{data:[],columns:g,searchObj:{messageStatus:""},stepArr:[{value:"DEVICE_REPORT_DATA",label:"设备上报数据"},{value:"PLATFORM_RESOLVING_DATA",label:"平台解析数据"},{value:"PLATFORM_RESOLVING_DATA_ERROR,",label:"平台解析数据错误"},{value:"MATCH_MODEL",label:"匹配物模型"},{value:"PLATFORM_SEND_COMMAND",label:"平台发送命令"},{value:"PLATFORM_SEND_DATA2MQ",label:"平台发送数据到消息队列"}],typeArr:[{value:"DEVICE2PLATFORM",label:"设备到平台"},{value:"PLATFORM2DEVICE",label:"平台到设备"},{value:"PLATFORM_FORWARD",label:"平台转发"}],lastTime:"",visible:!1,labelCol:{span:6},wrapperCol:{span:18},other:"",form:{dates:0,hours:0,minutes:30},rules:{dates:[{required:!0,message:"请输入",trigger:"blur"}]},isData:!1,isStop:!1,disabled:!1,timer:null,devVisible:!1,devObj:{},times:0,isBtnData:!1}},methods:{getList:function(){var e=this,t={ttl:"",messageStatus:this.searchObj.messageStatus,businessType:"",debugDevice:!1};this.$api.getDeviceMessage(this.deviceId,t).then(function(t){t.data.map(function(t){s()(t,{createTime:e.$getDate({timestamp:t.createTime})})}),e.data=t.data})},getInter:function(){var e=this;this.timer=setInterval(function(){e.getList()},5e3),this.$once("hook:beforeDestroy",function(){clearInterval(e.timer),e.timer=null})},getTimes:function(){var e=this;this.$api.getDeviceMessageTime(this.deviceId).then(function(t){e.lastTime=e.$getDate({timestamp:t.data})})},deleteMeaasge:function(){var e=this;clearInterval(this.timer),this.timer=null,this.$api.deleteDeviceMessageData(this.deviceId).then(function(t){e.isStop=!0,e.disabled=!0,e.isBtnData=!1})},stopMessage:function(){this.deleteMeaasge()},clearMessage:function(){var e=this;this.data=[],this.$api.deleteDataLog(this.deviceId).then(function(t){e.getList()})},showModal:function(){this.visible=!0,this.disabled=!1},handleOk:function(){var e=this;this.times=60*this.form.dates*60+60*this.form.hours+60*this.form.minutes;var t={deviceId:this.deviceId,ttl:this.times};this.$api.postDeviceMessage(t).then(function(t){e.visible=!1,e.isData=!0,e.isBtnData=!0,e.isStop=!1,e.getList(),e.getTimes(),e.getInter()})},closeHandle:function(){this.visible=!1,this.$refs.ruleForm.resetFields()},onSearch:function(){this.getList()},messageDetail:function(e){this.devVisible=!0,this.devObj=e},devhandleOk:function(){this.devVisible=!1}}},I={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"command-content"},[e._m(0),e._v(" "),e.isData?a("div",{staticClass:"info-box"},[a("div",[a("a-icon",{staticStyle:{color:"#1067EE",width:"14px",height:"13px"},attrs:{type:"message",theme:"filled"}}),e._v(" "),a("span",{staticStyle:{"margin-left":"15px"}},[e._v("\n             跟踪类型\n          ")]),e._v(" "),a("span",{staticStyle:{"margin-left":"15px"}},[e._v("执行情况\n            "),e.isStop?a("span",{staticStyle:{color:"#C91521"}},[e._v("[停止]")]):a("span",{staticStyle:{color:"#0456de"}},[e._v("[运行中]")])]),e._v(" "),a("span",{staticStyle:{"margin-left":"36px"}},[e._v("预计最晚结束时间："),a("span",[e._v(e._s(e.lastTime))])])],1),e._v(" "),a("div",[a("a-button",{attrs:{type:"primary",icon:"play-circle",disabled:e.disabled},on:{click:e.stopMessage}},[e._v("停止")]),e._v(" "),a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger",ghost:"",icon:"delete"},on:{click:e.clearMessage}},[e._v("清除数据")])],1)]):e._e(),e._v(" "),a("div",{staticClass:"command-title"},[a("a-button",{attrs:{disabled:e.isBtnData,type:"primary"},on:{click:e.showModal}},[e._v("启动消息跟踪")]),e._v(" "),e.isData?a("a-select",{staticStyle:{width:"200px",margin:"0 20px"},attrs:{placeholder:"请选择或搜索产品"},on:{search:e.onSearch},model:{value:e.searchObj.messageStatus,callback:function(t){e.$set(e.searchObj,"messageStatus",t)},expression:"searchObj.messageStatus"}},[a("a-select-option",{attrs:{value:""}},[e._v("\n          所有状态\n        ")]),e._v(" "),a("a-select-option",{attrs:{value:!0}},[e._v("\n          成功\n        ")]),e._v(" "),a("a-select-option",{attrs:{value:!1}},[e._v("\n          失败\n        ")])],1):e._e()],1),e._v(" "),e.isData?a("div",{staticClass:"table-box"},[a("a-table",{attrs:{columns:e.columns,rowKey:function(e,t){return t},pagination:!1,"data-source":e.data},scopedSlots:e._u([{key:"businessType",fn:function(t){return a("span",{},e._l(e.typeArr,function(i,s){return i.value===t?a("span",{key:s},[e._v(e._s(i.label))]):e._e()}),0)}},{key:"businessStep",fn:function(t){return a("span",{},e._l(e.stepArr,function(i,s){return i.value===t?a("span",{key:s},[e._v(e._s(i.label))]):e._e()}),0)}},{key:"messageStatus",fn:function(t){return a("span",{},[a("span",t?[e._v("\n            成功\n          ")]:[e._v("失败")])])}},{key:"action",fn:function(t,i){return a("span",{},[a("span",{staticClass:"table-btn",on:{click:function(t){return e.messageDetail(i)}}},[e._v("查看")])])}}],null,!1,909517423)})],1):e._e()]),e._v(" "),a("a-modal",{attrs:{width:600,title:"启动消息跟踪"},on:{ok:e.handleOk,cancel:e.closeHandle},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("div",{staticClass:"form-info"},[a("span",[a("a-icon",{staticStyle:{color:"#5e7ce0","margin-right":"10px"},attrs:{type:"info-circle"}}),e._v(" "),a("span",[e._v("再次启动消息跟踪，将会清除上次消息跟踪的历史数据，请确认是否启动消息跟踪？")])],1)]),e._v(" "),a("a-form-model",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{ref:"dates",attrs:{label:"消息跟踪时长",prop:"dates"}},[a("div",{staticClass:"form-flex"},[a("div",[a("a-input-number",{attrs:{id:"dates",min:0},model:{value:e.form.dates,callback:function(t){e.$set(e.form,"dates",t)},expression:"form.dates"}}),e._v(" "),a("span",{staticClass:"form-span"},[e._v("天")])],1),e._v(" "),a("div",[a("a-input-number",{attrs:{id:"hours",min:0},model:{value:e.form.hours,callback:function(t){e.$set(e.form,"hours",t)},expression:"form.hours"}}),e._v(" "),a("span",{staticClass:"form-span"},[e._v("小时")])],1),e._v(" "),a("div",[a("a-input-number",{attrs:{id:"minutes",min:0},model:{value:e.form.minutes,callback:function(t){e.$set(e.form,"minutes",t)},expression:"form.minutes"}}),e._v(" "),a("span",{staticClass:"form-span"},[e._v("分钟")])],1)])])],1)],1),e._v(" "),a("a-modal",{attrs:{width:600,title:"消息详情"},on:{ok:e.devhandleOk},model:{value:e.devVisible,callback:function(t){e.devVisible=t},expression:"devVisible"}},[a("div",{staticClass:"messaga-box"},[e._l(e.stepArr,function(t,i){return t.value===e.devObj.businessStep?a("p",{key:i},[e._v(e._s(t.label))]):e._e()}),e._v("\n     "+e._s(e.devObj.businessDetails)+"\n   ")],2)])],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"shadow-title"},[t("p",[this._v("消息跟踪可记录设备在运行过程中的各类操作信息，状态和结果。当数据上报、响应命令等业务场景中出现故障时，消息跟踪功能可帮助您快速进行故障定位和原因分析。")]),this._v(" "),t("p",[this._v("为避免占用读写计算、存储资源，同时保证数据有效，平台限制最长可跟踪3天的数据，且单个用户下，仅支持同时启动10个设备的消息跟踪。")])])}]};var k=[{dataIndex:"deviceStatus",title:"状态",key:"deviceStatus",ellipsis:!0,scopedSlots:{customRender:"deviceStatus"}},{dataIndex:"deviceLabel",title:"设备名称",ellipsis:!0,key:"deviceLabel"},{title:"设备标识码",ellipsis:!0,dataIndex:"deviceCode",key:"deviceCode"},{title:"所属产品",ellipsis:!0,dataIndex:"productLabel",key:"productLabel"},{title:"节点类型",ellipsis:!0,dataIndex:"nodeType",key:"nodeType",scopedSlots:{customRender:"nodeType"}},{title:"操作",key:"action",scopedSlots:{customRender:"action"}}],C={name:"childDevice",props:["deviceId"],data:function(){return{data:[],columns:k,searchObj:{},stateArr:[{value:"ONLINE",label:"在线"},{value:"WARN",label:"报警"},{value:"INACTIVE",label:"未激活"},{value:"OFFLINE",label:"离线"}],nodeArr:[{value:"GATEWAY",label:"直连设备"},{value:"ENDPOINT",label:"网关子设备"}],pagination:{showLessItems:!0,pageSizeOptions:["10","20","30"],showSizeChanger:!0,pageSize:10,current:1,hideOnSinglePage:!1,total:0},productArr:[],visible:!1,labelCol:{span:4},wrapperCol:{span:20},form:{deviceCode:"",deviceLabel:"",productId:"",gatewayId:""},rules:{productId:[{required:!0,message:"请选择或搜素产品",trigger:"blur"}],deviceCode:[{required:!0,message:"请输入设备标识码",trigger:"change"}]},devVisible:!1,devObj:{}}},created:function(){this.getList()},methods:{tableChange:function(e){this.pagination.pageSize=e.pageSize,this.pagination.current=e.current,this.pagination.total=e.total,this.getList()},getList:function(){var e=this,t={gateWayId:this.deviceId,page:this.pagination.current,pageSize:this.pagination.pageSize};this.$api.getSubDeviceList(t).then(function(t){var a=t.data;e.pagination.total=a.total,e.pagination.pageSize=a.size,e.pagination.current=a.current;var i=a.records;e.data=i})},deleteCancel:function(e){var t=this;this.$api.deleteSubDevice(e).then(function(e){t.getList()})},getProductList:function(){var e=this;this.$api.getProductAllList({limit:"",productLabel:""}).then(function(t){e.productArr=t.data})},productSearch:function(e){var t=this,a={limit:"",productLabel:e};this.$api.getProductAllList(a).then(function(e){t.productArr=e.data})},showModal:function(){this.visible=!0,this.form={},this.getProductList()},handleOk:function(){var e=this;this.form.gatewayId=this.deviceId,this.$refs.ruleForm.validate(function(t){t&&e.$api.postSubDevice(e.form).then(function(t){e.visible=!1,e.getList()})})},closeHandle:function(){this.visible=!1,this.$refs.ruleForm.resetFields()},onSearch:function(){},deviceDetails:function(e){this.devVisible=!0,this.devObj=e},DevHandleOk:function(){this.devVisible=!1}}},S={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"command-content"},[e._m(0),e._v(" "),a("div",{staticClass:"command-title"},[a("a-button",{attrs:{type:"primary"},on:{click:e.showModal}},[e._v("添加子设备")])],1),e._v(" "),a("div",{staticClass:"table-box"},[a("a-table",{attrs:{columns:e.columns,rowKey:function(e,t){return t},pagination:e.pagination,"data-source":e.data},on:{change:e.tableChange},scopedSlots:e._u([{key:"deviceStatus",fn:function(t,i){return a("span",{},e._l(e.stateArr,function(i,s){return i.value===t?a("span",{key:s},[e._v("\n              "+e._s(i.label)+"\n            ")]):e._e()}),0)}},{key:"nodeType",fn:function(t){return a("span",{},e._l(e.nodeArr,function(i,s){return i.value===t?a("span",{key:s},[e._v("\n              "+e._s(i.label)+"\n            ")]):e._e()}),0)}},{key:"action",fn:function(t,i){return a("span",{},[a("span",{staticClass:"table-btn",on:{click:function(t){return e.deviceDetails(i)}}},[e._v("查看")]),e._v(" "),a("a-popconfirm",{attrs:{title:"你确定删除此设备吗?","ok-text":"确定","cancel-text":"取消"},on:{confirm:function(t){return e.deleteCancel(i.id)}}},[a("span",{staticClass:"table-btn"},[e._v(" 删除 ")])])],1)}}])})],1)]),e._v(" "),a("a-modal",{attrs:{width:600,title:"添加子设备"},on:{ok:e.handleOk,cancel:e.closeHandle},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("a-form-model",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules,"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[a("a-form-model-item",{attrs:{label:"所属产品",prop:"productId"}},[a("a-select",{attrs:{"show-search":"",placeholder:"请选择或搜索产品","option-filter-prop":"children"},on:{search:e.productSearch},model:{value:e.form.productId,callback:function(t){e.$set(e.form,"productId",t)},expression:"form.productId"}},e._l(e.productArr,function(t,i){return a("a-select-option",{key:i,attrs:{value:t.id}},[e._v("\n              "+e._s(t.productLabel)+"\n            ")])}),1)],1),e._v(" "),a("a-form-model-item",{ref:"deviceLabel",attrs:{label:"设备名称"}},[a("a-input",{attrs:{placeholder:"请输入设备名称"},model:{value:e.form.deviceLabel,callback:function(t){e.$set(e.form,"deviceLabel",t)},expression:"form.deviceLabel"}})],1),e._v(" "),a("a-form-model-item",{ref:"deviceCode",attrs:{label:"设备标识码",prop:"deviceCode"}},[a("a-input",{attrs:{placeholder:"请输入设备标识码"},model:{value:e.form.deviceCode,callback:function(t){e.$set(e.form,"deviceCode",t)},expression:"form.deviceCode"}})],1)],1)],1),e._v(" "),a("a-modal",{attrs:{width:600,title:"设备详情"},on:{ok:e.DevHandleOk},model:{value:e.devVisible,callback:function(t){e.devVisible=t},expression:"devVisible"}},[a("a-descriptions",{attrs:{title:e.devObj.deviceLabel,bordered:"",column:2}},[a("a-descriptions-item",{attrs:{label:"状态"}},e._l(e.stateArr,function(t,i){return t.value===e.devObj.deviceStatus?a("span",{key:i},[e._v("\n              "+e._s(t.label)+"\n            ")]):e._e()}),0),e._v(" "),a("a-descriptions-item",{attrs:{label:"设备标识码"}},[e._v("\n          "+e._s(e.devObj.deviceCode)+"\n        ")]),e._v(" "),a("a-descriptions-item",{attrs:{label:"所属产品"}},[e._v("\n          "+e._s(e.devObj.productLabel)+"\n        ")]),e._v(" "),a("a-descriptions-item",{attrs:{label:"节点类型"}},e._l(e.nodeArr,function(t,i){return t.value===e.devObj.nodeType?a("span",{key:i},[e._v("\n              "+e._s(t.label)+"\n            ")]):e._e()}),0)],1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"shadow-title"},[t("p",[this._v(" 呈现通过网关方式接入到IoT的设备（传感器）。子设备的状态表示子设备接入网关的状态，由网关上报到IoT平台进行状态的刷新；如果网关不能正常上报子设备的状态信息到IoT平台，则展示的子设备状态不会刷新。 ")])])}]};var L={name:"equipmentDetails",components:{overView:o,commandAsy:p,equipmentShadow:a("C7Lr")(f,_,!1,function(e){a("C3bj")},"data-v-221c9803",null).exports,messageTrack:a("C7Lr")(y,I,!1,function(e){a("tZRC")},"data-v-06d2480d",null).exports,childDevice:a("C7Lr")(C,S,!1,function(e){a("iycM")},"data-v-4235c87d",null).exports},data:function(){return{tabIndex:"1",deviceId:"",productId:"",deviceObj:{}}},activated:function(){this.tabIndex="1",this.deviceId=this.$route.query.id,this.productId=this.$route.query.productId},created:function(){this.tabIndex="1",this.deviceId=this.$route.query.id,this.productId=this.$route.query.productId},methods:{goBack:function(){this.$router.push("/equipment")},changeTab:function(e){this.tabIndex=e},callback:function(){}}},D={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"home-title"},[a("span",{on:{click:e.goBack}},[a("a-icon",{attrs:{type:"arrow-left"}})],1),e._v(" "),a("span",[e._v("设备详情")])]),e._v(" "),a("div",{staticClass:"table-tab"},[a("a-tabs",{attrs:{destroyInactiveTabPane:""},on:{change:e.callback},model:{value:e.tabIndex,callback:function(t){e.tabIndex=t},expression:"tabIndex"}},[a("a-tab-pane",{key:"1",attrs:{tab:"概述"}},[a("overView",{attrs:{deviceId:e.deviceId},on:{tabIndex:e.changeTab}})],1),e._v(" "),a("a-tab-pane",{key:"2",attrs:{tab:"异步命令"}},[a("commandAsy",{attrs:{deviceId:e.deviceId,productId:e.productId}})],1),e._v(" "),a("a-tab-pane",{key:"3",attrs:{tab:"设备影子"}},[a("equipmentShadow",{attrs:{deviceId:e.deviceId}})],1),e._v(" "),a("a-tab-pane",{key:"4",attrs:{tab:"消息跟踪"}},[a("messageTrack",{attrs:{deviceId:e.deviceId}})],1),e._v(" "),a("a-tab-pane",{key:"5",attrs:{tab:"子设备"}},[a("childDevice",{attrs:{deviceId:e.deviceId}})],1)],1)],1)])},staticRenderFns:[]};var x=a("C7Lr")(L,D,!1,function(e){a("XiW8")},"data-v-77a2f4c6",null);t.default=x.exports},XiW8:function(e,t){},iycM:function(e,t){},r84h:function(e,t){},tZRC:function(e,t){}});
//# sourceMappingURL=4.bdde2b079a1fc5bd4db3.js.map